// ════════════════════════════════════════════════════════════════
// HC SEO KEYWORD VAULT v4 — Single source of truth
// Sources: hc-seo-seed-v3 + hc-domination-pack-v2
// ════════════════════════════════════════════════════════════════

export const KEYWORD_CLUSTERS = {
    transactional_services: [
        'pilot car service near me', 'oversize load escort service', 'wide load escort service',
        'hire escort vehicle near me', 'find escort vehicle fast', 'book pilot car online',
        'certified pilot car driver', 'heavy haul escort vehicle', 'escort vehicle service',
        '24 hour pilot car service', 'emergency pilot car escort', 'same day pilot car service',
        'last minute escort vehicle', 'on demand pilot car', 'pilot car company usa', 'pilot car company canada',
        // Domination Pack v2 additions
        'emergency pilot car near me', 'urgent wide load escort', 'rush heavy haul escort',
        'last minute oversize escort', 'same day pilot car service',
    ],
    jobs_and_recruitment: [
        'pilot car driver jobs', 'pilot car operator jobs', 'oversize escort jobs',
        'pilot car work near me', 'become escort vehicle driver', 'escort vehicle independent contractor',
        'pilot car owner operator', 'pilot car contractor work',
        'how to become a pilot car driver', 'how to start a pilot car business',
        'pilot car driver salary', 'how much do pilot car drivers make',
        'pilot car certification requirements', 'pilot car insurance requirements',
        // Job intent additions
        'escort vehicle driver jobs near me', 'oversize escort jobs hiring now',
        'independent pilot car operator work', 'find pilot car gigs',
    ],
    platform_and_apps: [
        'pilot car mobile app', 'pilot car load board', 'escort vehicle load board',
        'heavy haul escort app', 'oversize load board app', 'pilot car marketplace',
        'find pilot car drivers fast', 'pilot car booking platform',
        // Platform gap cluster (Killer Move #10)
        'pilot car marketplace usa', 'escort driver network',
        'oversize load matching platform', 'heavy haul escort marketplace',
        'best load board for pilot cars', 'free pilot car load board',
    ],
    directory_intent: [
        'pilot car directory', 'oversize load directory', 'escort vehicle directory',
        'pilot car companies directory', 'pilot car driver directory USA', 'pilot car directory Canada',
        'how to find pilot car jobs', 'where to find pilot car work',
        'escort service directory heavy haul', 'oversize transport directory',
    ],
    authority_and_rules: [
        'what is a pilot car', 'when is a pilot car required', 'pilot car requirements by state',
        'escort vehicle requirements USA', 'escort vehicle requirements Canada',
        'wide load escort laws by state', 'pilot car height pole rules',
        'oversize load regulations by state', 'pilot car certification by state',
        'heavy haul escort laws', 'oversize permit escort rules',
    ],
    // ── Domination Pack v2: Police escort ────────────────────────
    police_escort: [
        'police escort required oversize load', 'when is police escort required',
        'police escort wide load rules', 'oversize load police escort states',
        'do i need police escort heavy haul', 'state police escort requirements oversize',
        'escort vehicle vs police escort rules', 'super load police escort requirements',
        'police escort permit oversize load', 'law enforcement escort wide load',
        'police escort trigger by state', 'superload escort requirements',
        'high weight escort rules', 'overheight police escort rules', 'oversize permit police requirements',
    ],
    // ── Domination Pack v2: TWIC + Port ──────────────────────────
    twic_and_port: [
        'TWIC escort services', 'port escort vehicle', 'pilot car port escort',
        'heavy haul port escort', 'TWIC certified escort driver',
        'port access escort services', 'marine terminal escort vehicle',
        'port of entry escort truck', 'port logistics escort', 'oversize load port escort',
        'TWIC escort jobs', 'port escort driver jobs', 'TWIC pilot car jobs',
        'port escort hiring', 'marine terminal escort jobs',
    ],
    // ── Superload cluster ─────────────────────────────────────────
    superload: [
        'super load escort service', 'superload pilot car', 'extreme weight escort',
        'high pole escort service', 'multi escort wide load', 'oversize convoy escort',
        'certified escort operator heavy load', 'superload permit escort escort',
    ],
    // ── LSI expansion (Killer Move #10) ──────────────────────────
    lsi: [
        'pilot vehicle operator', 'oversize convoy escort', 'certified escort operator',
        'wide load lead vehicle', 'rear pilot vehicle', 'pilot car lead car',
        'oversize load support vehicle', 'chase car oversize',
    ],
    // ── Logistics Gravity v1: Wind Farm Belt ─────────────────────
    wind_farm: [
        'wind turbine escort service', 'wind farm pilot car', 'wind energy heavy haul escort',
        'turbine blade escort', 'wind project escort drivers', 'wind turbine component transport',
        'wind turbine nacelle transport escort', 'wind tower escort service',
        // Zones: West TX, OK, KS, IA, SD, AB, SK
        'west texas wind turbine escort', 'oklahoma wind escort', 'kansas wind energy escort',
        'iowa wind farm pilot car', 'south dakota wind project escort',
        'alberta wind corridor escort', 'saskatchewan wind turbine pilot car',
    ],
    // ── Logistics Gravity v1: Oil & Gas Basins ───────────────────
    oil_gas: [
        'oil field escort vehicle', 'rig move pilot car', 'oilfield heavy haul escort',
        'drilling rig escort', 'energy sector pilot car', 'oil patch escort service',
        'frac equipment pilot car', 'oil field wide load escort',
        // Basins: Permian TX, Eagle Ford TX, Bakken ND, Marcellus PA, Montney BC, Duvernay AB
        'permian basin pilot car service', 'eagle ford escort vehicle',
        'bakken oilfield escort', 'marcellus shale escort truck',
        'montney bc pilot car', 'duvernay ab heavy haul escort',
    ],
    // ── Logistics Gravity v1: Mega Construction ──────────────────
    mega_construction: [
        'construction escort vehicle', 'bridge beam escort', 'precast escort service',
        'heavy equipment escort construction', 'construction oversize loads',
        'data center construction escort', 'megasite equipment escort',
        'highway expansion pilot car', 'industrial site escort vehicle',
    ],
    // ── Logistics Gravity v1: Port Gravity (tier-1/2 patterns) ───
    port_gravity: [
        'pilot car service Port of Los Angeles', 'oversize escort Port of Houston',
        'heavy haul escort Port of Savannah', 'TWIC escort Port of Long Beach',
        'pilot car near Port of Seattle', 'port escort vehicle Port of Vancouver',
        'oversize escort Port of Prince Rupert', 'TWIC escort Port of Baltimore',
        'pilot car Port Everglades', 'escort vehicle Port of New Orleans',
        'port freight escort service', 'intermodal escort vehicle',
        'container port heavy haul escort', 'project cargo escort service',
    ],
    // ── Next-wave candidates (Logistics Gravity v1) ───────────────
    next_wave: [
        'intermodal rail ramp escort', 'distribution center heavy haul escort',
        'amazon fulfillment heavy haul', 'truck parking cluster pilot car',
        'cross border freight yard escort', 'rail yard escort service',
    ],
};

// ── AI Title Engine (Domination Pack v2) ─────────────────────
export const AI_TITLE_FORMULAS = {
    service: [
        (city: string, state: string) => `Pilot Car Service in ${city}, ${state} | 24/7 Oversize Escort`,
        (city: string, state: string) => `Wide Load Escort in ${city} (${state}) – Fast Response`,
        (city: string, state: string) => `Oversize Load Pilot Car ${city}, ${state} | Book Now`,
        (city: string, state: string) => `Certified Pilot Car Drivers in ${city}, ${state}`,
        (city: string, state: string) => `Heavy Haul Escort Service Near ${city}`,
    ],
    jobs: [
        (city: string, state: string) => `Pilot Car Driver Jobs in ${city}, ${state} (Hiring Now)`,
        (city: string, state: string) => `Oversize Escort Jobs ${city} ${state} | Apply Today`,
        (city: string, state: string) => `Independent Pilot Car Work in ${city}`,
        (city: string, state: string) => `Escort Vehicle Driver Jobs Near ${city}`,
    ],
    directory: [
        (city: string, state: string) => `Pilot Car Directory ${city}, ${state} | Find Escort Services`,
        (city: string, state: string) => `Best Pilot Car Companies in ${city}`,
        (city: string, state: string) => `Find Pilot Car Drivers Near ${city}`,
    ],
    corridor: [
        (corridor: string) => `Pilot Car Services Along ${corridor}`,
        (corridor: string) => `Oversize Load Escort ${corridor} Route Guide`,
        (corridor: string) => `Wide Load Pilot Cars on ${corridor}`,
        (corridor: string) => `Heavy Haul Support ${corridor}`,
    ],
    port: [
        (port: string) => `TWIC Escort Services ${port}`,
        (port: string) => `Pilot Car Port Escort ${port}`,
        (port: string) => `Oversize Load Escort Near ${port}`,
    ],
};

// Deterministic title picker — rotates by hash to avoid duplication
function hashStr(s: string): number {
    let h = 0;
    for (let i = 0; i < s.length; i++) { h = (Math.imul(31, h) + s.charCodeAt(i)) | 0; }
    return Math.abs(h);
}

export function getTitle(type: keyof typeof AI_TITLE_FORMULAS, ...args: string[]): string {
    const formulas = AI_TITLE_FORMULAS[type] as ((...args: string[]) => string)[];
    const idx = hashStr(args.join('-')) % formulas.length;
    return formulas[idx](...args);
}

// Programmatic page title templates (kept for backward compat)
export const PAGE_TITLE_TEMPLATES = {
    city_service: (city: string, state: string) => getTitle('service', city, state),
    city_jobs: (city: string, state: string) => getTitle('jobs', city, state),
    city_directory: (city: string, state: string) => getTitle('directory', city, state),
    state_service: (state: string) => `Pilot Car Services in ${state} | Haul Command`,
    state_jobs: (state: string) => `Pilot Car Driver Jobs in ${state} | Haul Command`,
    state_requirements: (state: string) => `Pilot Car Requirements in ${state} | Haul Command`,
    province_service: (province: string) => `Pilot Car Service in ${province}, Canada | Haul Command`,
    border_escort: (crossing: string) => `Oversize Escort Near ${crossing} Border | Haul Command`,
    port_escort: (port: string) => getTitle('port', `Port of ${port}`),
    corridor: (corridor: string) => getTitle('corridor', corridor),
    county: (county: string, state: string) => `Pilot Car Service in ${county}, ${state} | Haul Command`,
    emergency: (service: string) => `${service} | Emergency Dispatch | Haul Command`,
    vertical: (industry: string) => `${industry} Escort Services | Haul Command`,
};

// Meta description templates
export const META_DESC_TEMPLATES = {
    city_service: (city: string, state: string, count: number) =>
        `Find verified pilot car and oversize load escort services in ${city}, ${state}. ${count > 0 ? count + '+ certified drivers,' : 'Certified drivers,'} same-day dispatch, live availability.`,
    city_jobs: (city: string, state: string) =>
        `Pilot car driver jobs near ${city}, ${state}. Independent operator work, daily pay, flexible hours. Join the Haul Command network.`,
    state_service: (state: string, count: number) =>
        `${count > 0 ? count + '+ verified' : 'Verified'} pilot car and escort vehicle services across ${state}. Live driver availability, instant booking, competitive rates.`,
    port: (port: string) =>
        `TWIC-compliant escort vehicle services at ${port}. Certified oversize escort drivers with port access credentials available now.`,
    county: (county: string, state: string) =>
        `High-demand corridor: ${county}, ${state} has a significant oversize escort driver gap. Find or list pilot car services in this area.`,
    emergency: (service: string) =>
        `${service} available now on Haul Command. Verified certified pilot car operators, median dispatch in under 47 minutes.`,
};

// Scoring model (unchanged)
export function calcOpportunityScore(params: {
    searchIntentWeight: number;
    localGapScore: number;
    commercialValue: number;
    competitionInverse: number;
}): { score: number; band: 'Sniper' | 'Aggressive' | 'Long Game' | 'Monitor' } {
    const score = Math.round(
        params.searchIntentWeight * 0.35 +
        params.localGapScore * 0.25 +
        params.commercialValue * 0.25 +
        params.competitionInverse * 0.15
    );
    const band = score >= 80 ? 'Sniper' : score >= 60 ? 'Aggressive' : score >= 40 ? 'Long Game' : 'Monitor';
    return { score, band };
}

// Internal linking rules
export const LINKING_RULES = {
    city: ['link_to_state_page', 'link_to_nearby_cities', 'link_to_directory_hub', 'link_to_jobs_hub', 'link_to_load_board'],
    county: ['link_to_nearest_city', 'link_to_state_page', 'link_to_directory', 'city_links_back_to_county'],
    state: ['link_to_top_cities', 'link_to_requirements_page', 'link_to_directory', 'link_to_border_if_applicable'],
    corridor: ['link_to_cities_on_route', 'link_to_state_pages', 'link_to_directory', 'link_to_port_if_applicable'],
    port: ['link_to_twic_info', 'link_to_city_directory', 'link_to_jobs'],
    authority: ['money_page_links_to_rules', 'rules_links_to_services', 'directory_links_to_city', 'loadboard_links_to_jobs'],
};
